<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cicada 3301Â² â€“ Dino Run (EDC KPRCAS)</title>
  <meta name="description" content="A lightweight Chrome Dino style game that reveals a secret clue when the player reaches 3301 points, leading to the EDC KPRCAS website." />
  <style>
    :root{
      --bg:#0a0a0f; --fg:#e5e7eb; --muted:#9ca3af; --accent:#52ffa8;
      --card:#101118; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:radial-gradient(1200px 600px at 70% -10%, #182036 0%, #0a0a0f 60%);
      color:var(--fg); display:grid; place-items:center; overflow:hidden;
    }
    .wrap{width:min(900px,94vw);}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px}
    h1{font-size:clamp(18px,2.5vw,24px); margin:0; letter-spacing:.5px}
    .hint{color:var(--muted); font-size:13px}
    .panel{
      background:linear-gradient(180deg,#121422,#0e0f17); border:1px solid #1f2335;
      border-radius:18px; padding:14px; box-shadow:0 10px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.02)
    }
    canvas{display:block; width:100%; height:auto; background:linear-gradient(180deg,#0c0f1c 0%, #0b0d16 55%, #0a0a0f 100%);
      border-radius:14px; border:1px solid #1f2335}
    .hud{display:flex; align-items:center; justify-content:space-between; margin-top:10px; font-variant-numeric:tabular-nums}
    .btn{background:#14182a; border:1px solid #1f2335; color:var(--fg); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; transition: background-color 0.2s ease;}
    .btn:hover{background:#17203b}
    .score{font-weight:700}

    /* Overlay for clue */
    .overlay{position:fixed; inset:0; display:none; place-items:center; backdrop-filter:blur(6px) saturate(120%); background:rgba(3,6,15,.55);}
    .card{
      width:min(560px,92vw); background:linear-gradient(180deg,#0d0f19,#0b0e17);
      border:1px solid #2a324d; border-radius:20px; padding:18px; box-shadow:0 35px 80px rgba(0,0,0,.55)
    }
    .badge{display:inline-block; padding:4px 10px; border-radius:999px; border:1px solid #33406a; color:#a9b5d9; font-size:12px; margin-bottom:10px}
    .clue{
      font-size:clamp(16px,2.8vw,22px); line-height:1.3; word-break:break-word; margin:12px 0 16px;
      text-shadow:0 0 12px rgba(82,255,168,.45), 0 0 26px rgba(82,255,168,.25);
      color:var(--accent); font-weight:800; letter-spacing:.3px
    }
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .row .btn{flex:1}

    /* Simple glow for milestone text */
    .milestone{animation:glow 1.4s ease-in-out infinite alternate}
    @keyframes glow{from{text-shadow:0 0 0 rgba(82,255,168,.2)} to{ text-shadow:0 0 16px rgba(82,255,168,.6) }}

    .footer{margin-top:12px; color:#9aa3c2; font-size:12px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ðŸ¦– Dino Run â€“ EDC KPRCAS <span class="hint">(Clue unlocks at <strong>3301</strong>)</span></h1>
    <button id="resetBtn" class="btn" title="Restart (R)">Restart</button>
  </header>

  <div class="panel">
    <canvas id="game" width="900" height="240" aria-label="Dino game canvas"></canvas>
    <div class="hud">
      <div>
        <button id="jumpBtn" class="btn" title="Jump (Space/â†‘/Tap)">Jump</button>
        <span class="hint">Space / â†‘ or tap to jump</span>
      </div>
      <div class="score">Score: <span id="score">0</span></div>
    </div>
  </div>
  <div class="footer">Tip: Add <code>?clue=YOUR%20SECRET%20TEXT</code> to the URL to override the clue. Optional redirect: <code>&next=https%3A%2F%2Fexample.com%2Flevel-2</code>.</div>
</div>

<!-- Secret Clue Overlay -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true">
  <div class="card">
    <div class="badge">Milestone Reached</div>
    <h2 class="milestone" style="margin:0 0 4px">Score â‰¥ 3301</h2>
    <p class="hint" style="margin:0 0 10px">You earned a fragment. Decode and proceed.</p>
    <div id="clue" class="clue">â€¦</div>
    <div class="row">
      <button id="copyBtn" class="btn">Copy clue</button>
      <button id="nextBtn" class="btn">Go to Next Level</button>
      <button id="closeBtn" class="btn">Keep Playing</button>
    </div>
  </div>
</div>

<script>
  // =====================
  // SETTINGS (MODIFIED FOR EDC KPRCAS)
  // =====================
  // Base64-encoded default clue. New clue points to the role of the EDC.
  const DEFAULT_CLUE_B64 = "WW91ciBuZXh0IGNoYWxsZW5nZSBhd2FpdHMgd2hlcmUgY2FtcHVzIHN0YXJ0dXBzIGFyZSBib3JuLiBQcm9jZWVkIHRvIHRoZSBkaWdpdGFsIGhvbWUgb2Ygb3VyIGNvbGxlZ2UncyBpbm5vdmF0b3JzLg==";
  // Redirect to the official EDC KPRCAS website.
  const DEFAULT_NEXT_URL = "https://edckprcas.co.in";
  const TARGET_SCORE = 3301;

  // Read overrides from URL (?clue=... &next=...)
  const params = new URLSearchParams(location.search);
  const overrideClue = params.get("clue");
  const overrideNext = params.get("next");

  function decodeClue(){
    if(overrideClue) return decodeURIComponent(overrideClue);
    try{ return atob(DEFAULT_CLUE_B64); }catch(e){ return "CLUE_ERROR" }
  }

  // =====================
  // Minimal Dino Engine
  // =====================
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width; const H = canvas.height;

  let last = performance.now();
  let running = true;
  let speed = 5.5; // world speed
  let gravity = 0.6; // pixels per frame^2
  let scoreFloat = 0; // high-res score accumulator
  let score = 0;
  let clueShown = false;

  const dino = {
    x: 60, y: H-70, w: 36, h: 42,
    vy: 0, onGround: true,
    jump(){ if(this.onGround){ this.vy = -12.5; this.onGround = false; }}
  };

  const ground = { y: H-24 };

  const cacti = [];
  let spawnTimer = 0;

  function spawnCactus(){
    const w = 18 + Math.random()*16;
    const h = 26 + Math.random()*36;
    cacti.push({ x: W+20, y: ground.y - h, w, h });
  }

  function reset(){
    running = true; speed = 5.5; score = 0; scoreFloat = 0; clueShown = false;
    dino.x = 60; dino.y = H-70; dino.vy=0; dino.onGround = true;
    cacti.length = 0; spawnTimer = 0; last = performance.now();
    document.getElementById('overlay').style.display='none';
    loop(last);
  }

  function collide(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  function drawDino(){
    // A simple, abstract dino representation
    ctx.fillStyle = '#e5e7eb';
    ctx.fillRect(dino.x, dino.y, dino.w, dino.h); // body
    ctx.fillRect(dino.x + dino.w - 10, dino.y - 12, 16, 16); // head
    ctx.fillStyle = '#0a0a0f';
    ctx.fillRect(dino.x + dino.w + 2, dino.y - 6, 3, 3); // eye
    ctx.fillRect(dino.x + 6, dino.y + dino.h - 8, 6, 6); // leg notch
  }

  function drawGround(){
    ctx.fillStyle = '#111522';
    ctx.fillRect(0, ground.y, W, 2);
    // Dotted terrain for a sense of motion
    for(let i=0;i<W;i+=8){
      ctx.fillRect((i - (performance.now()/8)%8 + W)%W, ground.y+6, 3, 3);
    }
  }

  function drawCactus(c){
    ctx.fillStyle = '#a5b4fc';
    ctx.fillRect(c.x, c.y, c.w, c.h);
    // Arms for the cactus
    ctx.fillRect(c.x-6, c.y+6, 6, 14);
    ctx.fillRect(c.x+c.w, c.y+10, 6, 14);
  }

  function update(delta){
    // Speed up slightly over time for increasing difficulty
    speed += delta * 0.0004;

    // Gravity and jump physics
    dino.vy += gravity; dino.y += dino.vy;
    if(dino.y + dino.h >= ground.y){ dino.y = ground.y - dino.h; dino.vy = 0; dino.onGround = true; }

    // Spawn and move obstacles
    spawnTimer -= delta;
    if(spawnTimer <= 0){
      spawnCactus();
      spawnTimer = 650 + Math.random()*600 - speed*20; // Slightly faster spawns over time
      if(spawnTimer < 320) spawnTimer = 320; // Set a minimum spawn delay
    }
    for(let i=cacti.length-1;i>=0;i--){
      const c = cacti[i]; c.x -= speed* (delta/16);
      if(c.x + c.w < -40) cacti.splice(i,1); // Remove off-screen cacti
      if(collide({x:dino.x+4,y:dino.y+2,w:dino.w-8,h:dino.h-4}, c)){
        gameOver();
      }
    }

    // Update score
    scoreFloat += delta * 0.15;
    const newScore = Math.floor(scoreFloat);
    if(newScore !== score){
      score = newScore; document.getElementById('score').textContent = score;
      if(score >= TARGET_SCORE && !clueShown){ revealClue(); }
    }
  }

  function gameOver(){
    running = false;
    // Flash effect on game over
    ctx.save();
    ctx.globalAlpha = 0.18; ctx.fillStyle = '#ef4444'; ctx.fillRect(0,0,W,H); ctx.restore();
    // Game over text
    ctx.fillStyle = '#fca5a5'; ctx.font = 'bold 20px ui-sans-serif, system-ui';
    ctx.fillText('Game Over â€“ Press R to Restart', W/2 - 150, H/2);
  }

  function render(){
    ctx.clearRect(0,0,W,H);
    drawGround();
    // Parallax clouds for depth
    ctx.globalAlpha = 0.35; ctx.fillStyle = '#6b7280';
    for(let i=0;i<3;i++){
      const x = ( (performance.now()/ (30+ i*20)) % (W+160) ) - 80;
      ctx.fillRect(W - x, 40 + i*18, 40 + i*10, 10 + i*3);
    }
    ctx.globalAlpha = 1;

    // Dino and obstacles
    drawDino();
    cacti.forEach(drawCactus);

    // Thematic watermark
    ctx.globalAlpha = 0.07; ctx.font='900 120px ui-sans-serif, system-ui'; ctx.fillStyle='#52ffa8';
    ctx.fillText('3301', W-360, 140);
    ctx.globalAlpha = 1;
  }

  function loop(t){
    const delta = Math.min(50, t - last); last = t;
    if(running){ update(delta); render(); requestAnimationFrame(loop); }
  }

  function revealClue(){
    clueShown = true; running = false;
    const overlay = document.getElementById('overlay');
    document.getElementById('clue').textContent = decodeClue();
    overlay.style.display = 'grid';
  }

  // --- Controls ---
  function jump(){ dino.jump(); }
  addEventListener('keydown', (e)=>{
    if(e.code==='Space' || e.code==='ArrowUp'){ e.preventDefault(); jump(); }
    if(e.key==='r' || e.key==='R'){ reset(); }
  });
  document.getElementById('jumpBtn').addEventListener('click', jump);
  document.getElementById('resetBtn').addEventListener('click', reset);
  canvas.addEventListener('pointerdown', jump); // Mobile tap

  // --- Overlay Buttons ---
  document.getElementById('copyBtn').addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(document.getElementById('clue').textContent);
      // Using a simple alert for feedback as it's a temporary state
      alert('Clue copied to clipboard!');
    } catch(e){
      alert('Failed to copy. Please copy manually.');
    }
  });
  document.getElementById('closeBtn').addEventListener('click', ()=>{
    document.getElementById('overlay').style.display='none';
    running = true;
    last = performance.now();
    requestAnimationFrame(loop);
  });
  document.getElementById('nextBtn').addEventListener('click', ()=>{
    const next = overrideNext || DEFAULT_NEXT_URL;
    if(next){
      window.open(next, '_blank'); // Open in a new tab
    } else {
      alert('Organizer note: Next level URL is not set.');
    }
  });

  // Start the game loop
  requestAnimationFrame(loop);
</script>
</body>
</html>
